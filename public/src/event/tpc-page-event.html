<!--
Page ...
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="tpc-page-event">

	<template>
		<style>

		</style>
		<p>Page event</p>
		<a href="/home">Retour accueil</a>

		<p>{{event.title}}</p>
		<p>{{event.description}}</p>
		<p>{{event.date}}</p>
		<a href="{{event.link}}">Lien</a>
	</template>

	<script>
		Polymer({
			is: 'tpc-page-event',

			properties: {
				firebaseApp: {
					type: Object,
					notify: false
				},
				eventId: {
					type: Object,
					notify: true,
					observer: '_eventIdChanged'
				},
				event: {
					type: Object,
					notify: true
				}
			},

			queryDatabase: function () {
				var xhr = new XMLHttpRequest(),
					url = app.databaseURL +
						'/events/' +
						this.eventId +
						'.json';

				xhr.onreadystatechange = this.onProcessRequest.bind(this, xhr);
				xhr.open("GET", url, true);
				xhr.send();
			},

			onProcessRequest: function (xhr, event) {
				var response;

				if (xhr.readyState === 4 && xhr.status === 200) {
					response = JSON.parse(xhr.responseText);

					if (response) {
						this.event = response;
					}
				}
			},

			_eventIdChanged: function () {
				if (!this.event || this.event.$key !== this.eventId) {
					this.event = null;
					this.queryDatabase();
				}
			}
		});
	</script>
</dom-module>
