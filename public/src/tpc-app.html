<!--
Page principale de l'application hygie.
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">

<dom-module id="tpc-app">

	<template>
		<style>

		</style>

		<h1>Hello world !</h1>
	</template>

	<script>

		Polymer({
			is: 'tpc-app',

			properties: {
				firebaseApp: {
					type: Object,
					notify: true
				}
			},

			ready: function() {
				// Création de l'élément firebase-app
				this.firebaseApp = firebase.initializeApp({
					id: 'firebase-app',
					name: app.name,
					authDomain: app.authDomain,
					databaseURL: app.databaseURL,
					storageBucket: app.storageBucket,
					messagingSenderId: app.messagingSenderId
				});

				this.queryDatabase();
			},

			queryDatabase: function () {
				var xhr = new XMLHttpRequest(),
					url = app.databaseURL + '/events.json',
					params = {
						orderBy: '\"sortKey\"',
						startAt: '201705071930',
						limitToFirst: 10
					};

				// En attente de mieux
				url += '?orderBy=' + params.orderBy;
				url += '&startAt=' + params.startAt;
				url += '&limitToFirst=' + params.limitToFirst;

				xhr.onreadystatechange = this.onProcessRequest.bind(this, xhr);
				xhr.open("GET", url, true);
				xhr.send();
			},

			onProcessRequest: function (xhr, event) {
				var response;

				if (xhr.readyState === 4 && xhr.status === 200) {
					response = JSON.parse(xhr.responseText);

					if (response) {
						this.rawEvents = response;
					}
				}
			}
		});
	</script>
</dom-module>
